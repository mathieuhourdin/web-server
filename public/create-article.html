<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Créer un article</title>
        <link rel="stylesheet" type="text/css" href="/public/style.css" />
    </head>
    <Header />
    <body class="bg-pink">
        <div class="bg-skyblue ma-10p">
            <div class="pa-5p bg-skyblue">
                <div class="d-flex">
                    <h1>Créer un article</h1>
                    <button 
                        id="sendButton"
                        class="action-button ml-auto h-40p"
                        >
                     Enregistrer
                    </button>
                </div>
                <div class="pa-2p">
                    <div class="align-left ma-8 w-100p">
                        <label style="display: block" for="article-title">Titre de l'article</label>
                        <input id="article-title" class="w-100p" type="text" placeholder="Titre">
                    </div>
                    <div class="align-left ma-8 w-100p">
                        <label style="display: block" for="article-description">Description de l'article</label>
                        <input id="article-description" class="w-100p" type="text" placeholder="Titre" size=90>
                    </div>
                    <div class="align-left ma-8 w-100p">
                        <label style="display: block" for="article-image-url">Lien image de l'article</label>
                        <input id="article-image-url" class="w-100p" type="text" placeholder="Titre" size=90>
                    </div>
                    <div class="align-left ma-8 w-100p">
                        <label style="display: block" for="article-gdoc-url">Lien gdoc de l'article</label>
                        <input id="article-gdoc-url" class="w-100p" type="text" placeholder="Titre" size=90>
                    </div>
                    <div class="align-left ma-8 w-100p">
                        <label style="display: block" for="article-progress">Avancement de l'article</label>
                        <input id="article-progress" class="w-100p" type="number" min=0 max=100 placeholder="Progression" size=90>
                    </div>
                    <div class="align-left ma-8 w-100p">
                        <label style="display: block" for="article-url-slug">Suffix de l'url de l'article</label>
                        <input id="article-url-slug" class="w-100p" type="text" min=0 max=100 placeholder="Suffix url" size=90>
                    </div>
                    <div class="align-left ma-8 w-100p">
                        <label style="display: block" for="article-content">Contenu de l'article</label>
                        <textarea id="article-content" class="w-100p" type="text" placeholder="Titre" rows=120 cols=180></textarea>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>

<script>
    const button = document.getElementById("sendButton");

    const text = document.getElementById("text");


    const titleInput = document.getElementById("article-title");
    let articleTitle = "";
    titleInput.addEventListener("change", (event) => articleTitle = event.target.value);

    const descriptionInput = document.getElementById("article-description");
    let articleDescription = "";
    descriptionInput.addEventListener("change", (event) => articleDescription = event.target.value);

    const imageUrlInput = document.getElementById("article-image-url");
    let articleImageUrl = "";
    imageUrlInput.addEventListener("change", (event) => articleImageUrl = event.target.value);

    const gdocUrlInput = document.getElementById("article-gdoc-url");
    let articleGdocUrl = "";
    gdocUrlInput.addEventListener("change", (event) => articleGdocUrl = event.target.value);

    const progressInput = document.getElementById("article-progress");
    let articleProgress = "";
    progressInput.addEventListener("change", (event) => articleProgress = event.target.value);

    const urlSlugInput = document.getElementById("article-url-slug");
    let articleUrlSlug = "";
    urlSlugInput.addEventListener("change", (event) => articleUrlSlug = event.target.value);

    const contentInput = document.getElementById("article-content");
    let articleContent = "";
    contentInput.addEventListener("change", (event) => articleContent = event.target.value);

    button.addEventListener('click', function() {
            const url = process.env.API_URL + "/articles";
            const options = {
                    method: "POST",
                    credentials: "include",
                    body: JSON.stringify({
                            title: articleTitle,
                            description: articleDescription,
                            gdoc_url: articleGdocUrl,
                            image_url: articleImageUrl,
                            progress: Number(articleProgress),
                            url_slug: articleUrlSlug,
                            content: articleContent,
                        })
                };
            fetch(url, options)
                .then((response) => response.text())
                .then((data) => {
                        text.textContent = data + " ❤️ " ;
                        console.log(data)
                    });
        });

    const authButton = document.getElementById("authButton");

    authButton.addEventListener('click', async function() {
            console.log("New auth button click");
            const url = process.env.API_URL + "/sessions";
            const options = {
                    method: "POST",
                    body: JSON.stringify({username: "mathieu.hourdin@gmail.com", password: "mathieu"}),
                    credentials: "include"
                };
            fetch(url, options);
        });
</script>
