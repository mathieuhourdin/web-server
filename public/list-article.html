<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Cr√©er un article</title>
        <link rel="stylesheet" type="text/css" href="/public/style.css" />
    </head>
    <body class="ma-0" style="border-color: #e5e7eb">
        <Header />
        <section class="d-flex h-80 relative mat-80 justify-center items-center">
            <div class="absolute overflow-hidden w-100p h-100p opacity-30">
            <img
                src="https://img.freepik.com/photos-gratuite/jetee-au-bord-lac-hallstatt-autriche_181624-44201.jpg"
                class="absolute w-100p"
                fit="cover"
                position="center"
            ></img>
            </div>
            <h1 class="align-center text-bold text-2xl">üë®‚ÄçüöÄ Bienvenue plus proche du coeur</h1>
        </section>
        <div class="md:ma-10p ld:ma-5p mat-10" style="margin-top: 10px">
            <div class="pa-5p">
                <div class="pa-2p grid grid-cols-1 md:grid-cols-2" id="articles-list">
                </div>
            </div>
        </div>
    </body>
</html>

<script>

    const articlesListElement = document.getElementById("articles-list");
    let articlesListData = [];

    addEventListener("load", async (event) => await fetchArticles());

    const fetchArticles = async () => {
        const getUrl = process.env.API_URL + "/articles";
        const options = {
                method: "GET",
                credentials: "include",
            };
        const response = await fetch(getUrl, options);
        articlesListData = await response.json();
        articlesListData.forEach((article) => {
            const newArticleElement = createArticleElementFromJson(article);
            articlesListElement.appendChild(newArticleElement);
        })
    }

    const createArticleElementFromJson = (article) => {
        const containerElement = document.createElement("div");
        containerElement.classList.add("ma-20", "align-center");
        linkElement = document.createElement("a");
        linkElement.href = "/see-article/" + article.uuid;
        containerElement.appendChild(linkElement);
        //image element
        const imageElement = document.createElement("img");
        imageElement.src = article.image_url;
        imageElement.width = 500;
        imageElement.classList.add("rounded-xl", "ratio-2", "mw-100p");
        linkElement.appendChild(imageElement);
        //title element
        const titleElement = document.createElement("div");
        titleElement.textContent = article.title;
        titleElement.classList.add("text-bold");
        linkElement.appendChild(titleElement);
        //description element
        const descriptionElement = document.createElement("div");
        descriptionElement.textContent = article.description;
        linkElement.appendChild(descriptionElement);
        return containerElement;
    }
    

    const authButton = document.getElementById("authButton");

    authButton.addEventListener('click', async function() {
            console.log("New auth button click");
            const url = process.env.API_URL + "/sessions";
            const options = {
                    method: "POST",
                    body: JSON.stringify({username: "mathieu.hourdin@gmail.com", password: "mathieu"}),
                    credentials: "include"
                };
            fetch(url, options);
        });
</script>
