<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Cr√©er un article</title>
        <link rel="stylesheet" type="text/css" href="/public/style.css" />
    </head>
    <Header />
    <body class="">
        <div class="ma-10p">
            <div class="pa-5p">
                <div class="d-flex">
                    <img id="article-image" class="rounded-xl mw-100p ml-auto mr-auto"></img>
                </div>
                 <div class="d-flex">
                     <h1 id="article-title" class="align-center"></h1>
                     <a id="edit-link" class="ml-auto">Editer</a>
                 </div>
                 <h3 id="article-description" class="align-center mab-50"><h3>
                <div id="article-content"></div>
            </div>
        </div>
    </body>
</html>
<script src="https://cdn.jsdelivr.net/npm/marked@3.0.8/marked.min.js"></script>
<script>

    const articleId = INJECTED_ARTICLE_ID;
    const editLink = document.getElementById("edit-link");
    editLink.href = "/edit-article/" + articleId;

    const articleTitleElement = document.getElementById("article-title");
    const articleDescriptionElement = document.getElementById("article-description");
    const articleContentElement = document.getElementById("article-content");
    const articleImageElement = document.getElementById("article-image");

    let articleData = {};

    addEventListener("load", async (event) => await fetchArticle());

    const fetchArticle = async () => {
        const getUrl = process.env.API_URL + "/articles/" + articleId;
        const options = {
                method: "GET",
                credentials: "include",
            };
        const response = await fetch(getUrl, options);
        articleData = await response.json();
        articleTitleElement.textContent = articleData.title;
        articleDescriptionElement.textContent = articleData.description;
        articleImageElement.src = articleData.image_url;
        articleContentElement.innerHTML = marked(articleData.content);

    }

    const authButton = document.getElementById("authButton");

    authButton.addEventListener('click', async function() {
            console.log("New auth button click");
            const url = process.env.API_URL + "/sessions";
            const options = {
                    method: "POST",
                    body: JSON.stringify({username: "mathieu.hourdin@gmail.com", password: "mathieu"}),
                    credentials: "include"
                };
            fetch(url, options);
        });
</script>
